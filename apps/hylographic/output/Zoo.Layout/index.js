// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Zoo_DiagramTypes from "../Zoo.DiagramTypes/index.js";
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var treeRoot = function (v) {
    if (v instanceof Zoo_DiagramTypes.Leaf) {
        return v.value0;
    };
    if (v instanceof Zoo_DiagramTypes.Branch) {
        return v.value0;
    };
    throw new Error("Failed pattern match at Zoo.Layout (line 143, column 1 - line 143, column 47): " + [ v.constructor.name ]);
};
var treeDepth = function (v) {
    if (v instanceof Zoo_DiagramTypes.Leaf) {
        return 1;
    };
    if (v instanceof Zoo_DiagramTypes.Branch) {
        return 1 + max(treeDepth(v.value1))(treeDepth(v.value2)) | 0;
    };
    throw new Error("Failed pattern match at Zoo.Layout (line 148, column 1 - line 148, column 40): " + [ v.constructor.name ]);
};
var nodeR = function (config) {
    return function (node) {
        if (node.highlight) {
            return config.highlightRadius;
        };
        return config.nodeRadius;
    };
};
var positionNode = function (config) {
    return function (node) {
        return function (x) {
            return function (y) {
                return {
                    node: node,
                    x: x,
                    y: y,
                    radius: nodeR(config)(node)
                };
            };
        };
    };
};
var makeLink = function (from) {
    return function (to) {
        return {
            x1: from.x + from.radius,
            y1: from.y,
            x2: to.x - to.radius,
            y2: to.y
        };
    };
};
var layoutTreeNode = function (config) {
    return function (availWidth) {
        return function (levelHeight) {
            return function (cx) {
                return function (cy) {
                    return function (tree) {
                        if (tree instanceof Zoo_DiagramTypes.Leaf) {
                            return {
                                nodes: [ positionNode(config)(tree.value0)(cx)(cy) ],
                                links: [  ]
                            };
                        };
                        if (tree instanceof Zoo_DiagramTypes.Branch) {
                            var thisNode = positionNode(config)(tree.value0)(cx)(cy);
                            var rightCx = cx + availWidth / 4.0;
                            var leftCx = cx - availWidth / 4.0;
                            var childY = cy + levelHeight;
                            var leftLink = {
                                x1: cx,
                                y1: cy + nodeR(config)(tree.value0),
                                x2: leftCx,
                                y2: childY - nodeR(config)(treeRoot(tree.value1))
                            };
                            var rightLink = {
                                x1: cx,
                                y1: cy + nodeR(config)(tree.value0),
                                x2: rightCx,
                                y2: childY - nodeR(config)(treeRoot(tree.value2))
                            };
                            var childWidth = availWidth / 2.0;
                            var leftResult = layoutTreeNode(config)(childWidth)(levelHeight)(leftCx)(childY)(tree.value1);
                            var rightResult = layoutTreeNode(config)(childWidth)(levelHeight)(rightCx)(childY)(tree.value2);
                            return {
                                nodes: append([ thisNode ])(append(leftResult.nodes)(rightResult.nodes)),
                                links: append([ leftLink, rightLink ])(append(leftResult.links)(rightResult.links))
                            };
                        };
                        throw new Error("Failed pattern match at Zoo.Layout (line 113, column 59 - line 140, column 8): " + [ tree.constructor.name ]);
                    };
                };
            };
        };
    };
};
var layoutSplitPath = function (config) {
    return function (input) {
        return function (leftPath) {
            return function (rightPath) {
                var topY = config.height * 0.3;
                var rightX = config.width * 0.7;
                var topNode = positionNode(config)({
                    label: "...",
                    role: Zoo_DiagramTypes.Intermediate.value,
                    highlight: false
                })(rightX)(topY);
                var inputPos = positionNode(config)(input)(config.width * 0.2)(config.height / 2.0);
                var botY = config.height * 0.7;
                var botNode = positionNode(config)({
                    label: "...",
                    role: Zoo_DiagramTypes.Intermediate.value,
                    highlight: false
                })(rightX)(botY);
                var links = [ {
                    x1: inputPos.x + inputPos.radius,
                    y1: inputPos.y,
                    x2: topNode.x - topNode.radius,
                    y2: topNode.y
                }, {
                    x1: inputPos.x + inputPos.radius,
                    y1: inputPos.y,
                    x2: botNode.x - botNode.radius,
                    y2: botNode.y
                } ];
                return {
                    nodes: [ inputPos, topNode, botNode ],
                    links: links,
                    width: config.width,
                    height: config.height
                };
            };
        };
    };
};
var layoutSequence = function (config) {
    return function (nodes) {
        var usableWidth = config.width - 2.0 * config.padding;
        var cy = config.height / 2.0;
        var count = Data_Array.length(nodes);
        var spacing = (function () {
            var $30 = count > 1;
            if ($30) {
                return usableWidth / Data_Int.toNumber(count - 1 | 0);
            };
            return 0.0;
        })();
        var startX = (function () {
            var $31 = count === 1;
            if ($31) {
                return config.width / 2.0;
            };
            return config.padding;
        })();
        var positioned = Data_Array.mapWithIndex(function (i) {
            return function (node) {
                return positionNode(config)(node)(startX + Data_Int.toNumber(i) * spacing)(cy);
            };
        })(nodes);
        var links = (function () {
            var $32 = count > 1;
            if ($32) {
                return Data_Array.zipWith(makeLink)(positioned)(Data_Array.drop(1)(positioned));
            };
            return [  ];
        })();
        return {
            nodes: positioned,
            links: links,
            width: config.width,
            height: config.height
        };
    };
};
var layoutFusedArrow = function (config) {
    return function (from) {
        return function (to) {
            var rightX = config.width * 0.75;
            var leftX = config.width * 0.25;
            var cy = config.height / 2.0;
            var fromPos = positionNode(config)(from)(leftX)(cy);
            var toPos = positionNode(config)(to)(rightX)(cy);
            var link = makeLink(fromPos)(toPos);
            return {
                nodes: [ fromPos, toPos ],
                links: [ link ],
                width: config.width,
                height: config.height
            };
        };
    };
};
var defaultConfig = {
    width: 500.0,
    height: 420.0,
    padding: 55.0,
    nodeRadius: 30.0,
    highlightRadius: 40.0
};
var countLeaves = function (v) {
    if (v instanceof Zoo_DiagramTypes.Leaf) {
        return 1;
    };
    if (v instanceof Zoo_DiagramTypes.Branch) {
        return countLeaves(v.value1) + countLeaves(v.value2) | 0;
    };
    throw new Error("Failed pattern match at Zoo.Layout (line 153, column 1 - line 153, column 42): " + [ v.constructor.name ]);
};
var layoutBinTree = function (config) {
    return function (tree) {
        var usableWidth = config.width - 2.0 * config.padding;
        var usableHeight = config.height - 2.0 * config.padding;
        var leafCount = countLeaves(tree);
        var depth = treeDepth(tree);
        var levelHeight = usableHeight / Data_Int.toNumber(depth);
        var positioned = layoutTreeNode(config)(usableWidth)(levelHeight)(config.width / 2.0)(config.padding + config.nodeRadius)(tree);
        return {
            nodes: positioned.nodes,
            links: positioned.links,
            width: config.width,
            height: config.height
        };
    };
};
var consListToArray = function (v) {
    if (v instanceof Zoo_DiagramTypes.Nil) {
        return [  ];
    };
    if (v instanceof Zoo_DiagramTypes.Cons) {
        return append([ v.value0 ])(consListToArray(v.value1));
    };
    throw new Error("Failed pattern match at Zoo.Layout (line 190, column 1 - line 190, column 61): " + [ v.constructor.name ]);
};
var layoutHorizList = function (config) {
    return function (list) {
        var usableWidth = config.width - 2.0 * config.padding;
        var nodes = consListToArray(list);
        var cy = config.height / 2.0;
        var count = Data_Array.length(nodes);
        var spacing = (function () {
            var $41 = count > 1;
            if ($41) {
                return usableWidth / Data_Int.toNumber(count - 1 | 0);
            };
            return 0.0;
        })();
        var positioned = Data_Array.mapWithIndex(function (i) {
            return function (node) {
                return positionNode(config)(node)(config.padding + Data_Int.toNumber(i) * spacing)(cy);
            };
        })(nodes);
        var links = (function () {
            var $42 = count > 1;
            if ($42) {
                return Data_Array.zipWith(makeLink)(positioned)(Data_Array.drop(1)(positioned));
            };
            return [  ];
        })();
        return {
            nodes: positioned,
            links: links,
            width: config.width,
            height: config.height
        };
    };
};
var layoutVertList = function (config) {
    return function (list) {
        var usableHeight = config.height - 2.0 * config.padding;
        var nodes = consListToArray(list);
        var cx = config.width / 2.0;
        var count = Data_Array.length(nodes);
        var spacing = (function () {
            var $43 = count > 1;
            if ($43) {
                return usableHeight / Data_Int.toNumber(count - 1 | 0);
            };
            return 0.0;
        })();
        var positioned = Data_Array.mapWithIndex(function (i) {
            return function (node) {
                return positionNode(config)(node)(cx)(config.padding + Data_Int.toNumber(i) * spacing);
            };
        })(nodes);
        var links = (function () {
            var $44 = count > 1;
            if ($44) {
                return Data_Array.zipWith(makeLink)(positioned)(Data_Array.drop(1)(positioned));
            };
            return [  ];
        })();
        return {
            nodes: positioned,
            links: links,
            width: config.width,
            height: config.height
        };
    };
};
var layoutDiagram = function (config) {
    return function (struct) {
        if (struct instanceof Zoo_DiagramTypes.ExprTree) {
            return layoutBinTree(config)(struct.value0);
        };
        if (struct instanceof Zoo_DiagramTypes.HorizList) {
            return layoutHorizList(config)(struct.value0);
        };
        if (struct instanceof Zoo_DiagramTypes.VertList) {
            return layoutVertList(config)(struct.value0);
        };
        if (struct instanceof Zoo_DiagramTypes.Sequence) {
            return layoutSequence(config)(struct.value0);
        };
        if (struct instanceof Zoo_DiagramTypes.FusedArrow) {
            return layoutFusedArrow(config)(struct.value0)(struct.value1);
        };
        if (struct instanceof Zoo_DiagramTypes.SplitPath) {
            return layoutSplitPath(config)(struct.value0.input)(struct.value0.leftPath)(struct.value0.rightPath);
        };
        throw new Error("Failed pattern match at Zoo.Layout (line 68, column 31 - line 75, column 52): " + [ struct.constructor.name ]);
    };
};
export {
    defaultConfig,
    layoutDiagram,
    layoutBinTree,
    layoutTreeNode,
    treeRoot,
    treeDepth,
    countLeaves,
    layoutHorizList,
    consListToArray,
    layoutVertList,
    layoutSequence,
    layoutFusedArrow,
    layoutSplitPath,
    positionNode,
    nodeR,
    makeLink
};
//# sourceMappingURL=index.js.map
