{"comments":"L-System Recursion Schemes\n\nThe heart of the L-system visualization: expressing expansion and\ninterpretation as recursion schemes.\n\n## The Hylomorphism\n\nAn L-system rendering is a textbook hylomorphism:\n\n  data → unfold (ana) → intermediate structure → fold (cata) → result\n  seed → expand rules → expanded string → interpret turtle → segments\n\nIn category theory terms:\n  hylo = cata ∘ ana\n  render = interpret ∘ expand\n\n## The Apomorphism\n\nFor lazy/infinite generation, we use an apomorphism - an unfold that\ncan terminate early by providing a pre-computed result:\n\n  apo :: (a → f (Either (Fix f) a)) → a → Fix f\n\nThe coalgebra can return:\n  - Right a: continue unfolding\n  - Left (Fix f): stop here with this result\n\nThis lets us stop expanding when the viewport is filled.\n","declarations":[{"children":[],"comments":"Expand an L-system string by one iteration.\nThis is the coalgebra for our unfold.\n\nFor each character:\n  - If there's a production rule, apply it\n  - Otherwise, keep the character unchanged\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"LSystem"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[52,42],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[52,1]},"title":"expandOnce"},{"children":[],"comments":"Expand an L-system n times.\nThis is ana applied n times (iterated anamorphism).\n\nexpand 0 sys = sys.axiom\nexpand n sys = expandOnce sys (expand (n-1) sys)\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"LSystem"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[63,35],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[63,1]},"title":"expand"},{"children":[{"comments":null,"info":{"arguments":[],"declType":"dataConstructor"},"sourceSpan":{"end":[76,12],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[76,3]},"title":"Forward"},{"comments":null,"info":{"arguments":[],"declType":"dataConstructor"},"sourceSpan":{"end":[77,13],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[77,3]},"title":"TurnLeft"},{"comments":null,"info":{"arguments":[],"declType":"dataConstructor"},"sourceSpan":{"end":[78,14],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[78,3]},"title":"TurnRight"},{"comments":null,"info":{"arguments":[],"declType":"dataConstructor"},"sourceSpan":{"end":[79,9],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[79,3]},"title":"Push"},{"comments":null,"info":{"arguments":[],"declType":"dataConstructor"},"sourceSpan":{"end":[80,8],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[80,3]},"title":"Pop"},{"comments":null,"info":{"arguments":[],"declType":"dataConstructor"},"sourceSpan":{"end":[81,9],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[81,3]},"title":"NoOp"}],"comments":"Turtle command - the intermediate representation\n","info":{"dataDeclType":"data","declType":"data","roles":[],"typeArguments":[]},"kind":null,"sourceSpan":{"end":[81,9],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[75,1]},"title":"TurtleCmd"},{"children":[],"comments":"Parse a character into a turtle command.\nThis is the interpretation mapping.\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Char"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Zoo","LSystem","Schemes"],"TurtleCmd"],"tag":"TypeConstructor"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[85,30],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[85,1]},"title":"parseCmd"},{"children":[],"comments":"Interpretation state during the fold.\n","info":{"arguments":[],"declType":"typeSynonym","type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Record"],"tag":"TypeConstructor"},{"annotation":[],"contents":["turtle",{"annotation":[],"contents":[["Zoo","LSystem","Types"],"TurtleState"],"tag":"TypeConstructor"},{"annotation":[],"contents":["stack",{"annotation":[],"contents":[["Zoo","LSystem","Types"],"TurtleStack"],"tag":"TypeConstructor"},{"annotation":[],"contents":["segments",{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Array"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"Segment"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":["depth",{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"},{"annotation":[],"tag":"REmpty"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[105,4],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[100,1]},"title":"InterpState"},{"children":[],"comments":null,"info":{"declType":"value","type":{"annotation":[],"contents":[["Zoo","LSystem","Schemes"],"InterpState"],"tag":"TypeConstructor"}},"kind":null,"sourceSpan":{"end":[107,28],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[107,1]},"title":"initialState"},{"children":[],"comments":"Execute one turtle command.\nThis is the algebra for our fold.\n\nThe algebra (TurtleCmd × State) → State says:\n\"Given a command and current state, produce new state\"\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Schemes"],"TurtleCmd"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Schemes"],"InterpState"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Zoo","LSystem","Schemes"],"InterpState"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[120,74],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[120,1]},"title":"executeCmd"},{"children":[],"comments":"Interpret a string as turtle commands, producing segments.\nThis is the catamorphism: fold the string into a result.\n\ninterpret angle stepLength str = foldl (flip (executeCmd angle stepLength ∘ parseCmd)) initialState (toCharArray str)\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Array"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"Segment"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[170,57],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[170,1]},"title":"interpret"},{"children":[],"comments":"Render an L-system: expand n times, then interpret.\nThis is the hylomorphism: hylo = cata ∘ ana\n\nNote: In a true hylomorphism, the intermediate structure (expanded string)\nis never materialized - it's fused away. Here we do materialize it for\nclarity, but a production version could use streaming.\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"LSystem"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"RenderConfig"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Array"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"Segment"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[189,58],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[189,1]},"title":"render"},{"children":[{"comments":null,"info":{"arguments":[{"annotation":[],"contents":"a","tag":"TypeVar"}],"declType":"dataConstructor"},"sourceSpan":{"end":[207,30],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[207,24]},"title":"Stop"},{"comments":null,"info":{"arguments":[{"annotation":[],"contents":"b","tag":"TypeVar"}],"declType":"dataConstructor"},"sourceSpan":{"end":[207,43],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[207,33]},"title":"Continue"}],"comments":"Either type for apomorphism\nLeft = stop with this result, Right = continue\n","info":{"dataDeclType":"data","declType":"data","roles":["Representational","Representational"],"typeArguments":[["a",null],["b",null]]},"kind":null,"sourceSpan":{"end":[207,45],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[207,1]},"title":"LSystemEither"},{"children":[],"comments":"Lazy expansion that stops when viewport is filled.\nThis is the apomorphism: an unfold with early termination.\n\nThe coalgebra returns:\n  - Continue state: keep expanding\n  - Stop segments: we're done, here's the result\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"LSystem"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"RenderConfig"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"Viewport"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"ExpansionState"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Array"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"Segment"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[215,85],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[215,1]},"title":"expandLazy"},{"children":[],"comments":"Initial expansion state from an L-system\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"LSystem"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"ExpansionState"],"tag":"TypeConstructor"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[249,46],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[249,1]},"title":"initialExpansion"},{"children":[],"comments":"Render lazily until viewport is filled\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"LSystem"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"RenderConfig"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"Viewport"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Array"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"Segment"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[259,67],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[259,1]},"title":"renderLazy"},{"children":[],"comments":"L-system with parameters that can drift.\n","info":{"arguments":[],"declType":"typeSynonym","type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Record"],"tag":"TypeConstructor"},{"annotation":[],"contents":["base",{"annotation":[],"contents":[["Zoo","LSystem","Types"],"LSystem"],"tag":"TypeConstructor"},{"annotation":[],"contents":["angleDrift",{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":["lengthDrift",{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"tag":"REmpty"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[272,4],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[268,1]},"title":"ParametricLSystem"},{"children":[],"comments":"Apply drift to create a varied L-system\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Schemes"],"ParametricLSystem"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"LSystem"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[275,53],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[275,1]},"title":"applyDrift"},{"children":[],"comments":"Render with drift applied\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Schemes"],"ParametricLSystem"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"RenderConfig"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Array"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Zoo","LSystem","Types"],"Segment"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[280,87],"name":"../../showcases/psd3-prim-zoo-mosh/src/Zoo/LSystem/Schemes.purs","start":[280,1]},"title":"renderWithDrift"}],"name":"Zoo.LSystem.Schemes","reExports":[]}