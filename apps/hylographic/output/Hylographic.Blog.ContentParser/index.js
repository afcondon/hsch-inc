// Generated by purs version 0.15.15
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_String_CodePoints from "../Data.String.CodePoints/index.js";
import * as Data_String_Common from "../Data.String.Common/index.js";
import * as Data_String_Regex from "../Data.String.Regex/index.js";
import * as Data_String_Regex_Flags from "../Data.String.Regex.Flags/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showString);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var HtmlContent = /* #__PURE__ */ (function () {
    function HtmlContent(value0) {
        this.value0 = value0;
    };
    HtmlContent.create = function (value0) {
        return new HtmlContent(value0);
    };
    return HtmlContent;
})();
var VizComponent = /* #__PURE__ */ (function () {
    function VizComponent(value0) {
        this.value0 = value0;
    };
    VizComponent.create = function (value0) {
        return new VizComponent(value0);
    };
    return VizComponent;
})();
var vizRegex = /* #__PURE__ */ Data_String_Regex.regex("\\{\\{viz:([^}]+)\\}\\}")(Data_String_Regex_Flags.global);
var showContentSegment = {
    show: function (v) {
        if (v instanceof HtmlContent) {
            return "HtmlContent(" + (show(Data_String_CodePoints.take(50)(v.value0)) + "...)");
        };
        if (v instanceof VizComponent) {
            return "VizComponent(" + (v.value0 + ")");
        };
        throw new Error("Failed pattern match at Hylographic.Blog.ContentParser (line 19, column 1 - line 21, column 60): " + [ v.constructor.name ]);
    }
};
var findVizTag = function (content) {
    var v = Data_String_CodePoints.indexOf("{{viz:")(content);
    if (v instanceof Data_Maybe.Nothing) {
        return Data_Maybe.Nothing.value;
    };
    if (v instanceof Data_Maybe.Just) {
        var afterStart = Data_String_CodePoints.drop(v.value0 + 6 | 0)(content);
        var v1 = Data_String_CodePoints.indexOf("}}")(afterStart);
        if (v1 instanceof Data_Maybe.Nothing) {
            return Data_Maybe.Nothing.value;
        };
        if (v1 instanceof Data_Maybe.Just) {
            var componentName = Data_String_CodePoints.take(v1.value0)(afterStart);
            var before = Data_String_CodePoints.take(v.value0)(content);
            var after = Data_String_CodePoints.drop(v1.value0 + 2 | 0)(afterStart);
            return new Data_Maybe.Just({
                before: before,
                componentName: Data_String_Common.trim(componentName),
                after: after
            });
        };
        throw new Error("Failed pattern match at Hylographic.Blog.ContentParser (line 72, column 9 - line 80, column 79): " + [ v1.constructor.name ]);
    };
    throw new Error("Failed pattern match at Hylographic.Blog.ContentParser (line 66, column 3 - line 80, column 79): " + [ v.constructor.name ]);
};
var extractSegments = function (content) {
    var go = function ($copy_remaining) {
        return function ($copy_acc) {
            var $tco_var_remaining = $copy_remaining;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(remaining, acc) {
                var v = findVizTag(remaining);
                if (v instanceof Data_Maybe.Nothing) {
                    var $23 = Data_String_Common["null"](remaining);
                    if ($23) {
                        $tco_done = true;
                        return acc;
                    };
                    $tco_done = true;
                    return append1(acc)([ new HtmlContent(remaining) ]);
                };
                if (v instanceof Data_Maybe.Just) {
                    var newAcc = (function () {
                        var $24 = Data_String_Common["null"](v.value0.before);
                        if ($24) {
                            return append1(acc)([ new VizComponent(v.value0.componentName) ]);
                        };
                        return append1(acc)([ new HtmlContent(v.value0.before), new VizComponent(v.value0.componentName) ]);
                    })();
                    $tco_var_remaining = v.value0.after;
                    $copy_acc = newAcc;
                    return;
                };
                throw new Error("Failed pattern match at Hylographic.Blog.ContentParser (line 47, column 7 - line 59, column 28): " + [ v.constructor.name ]);
            };
            while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_remaining, $copy_acc);
            };
            return $tco_result;
        };
    };
    return go(content)([  ]);
};
var parseContent = function (content) {
    if (vizRegex instanceof Data_Either.Left) {
        return [ new HtmlContent(content) ];
    };
    if (vizRegex instanceof Data_Either.Right) {
        var segments = extractSegments(content);
        var parts = Data_String_Regex.split(vizRegex.value0)(content);
        return segments;
    };
    throw new Error("Failed pattern match at Hylographic.Blog.ContentParser (line 27, column 3 - line 37, column 17): " + [ vizRegex.constructor.name ]);
};
var eqContentSegment = {
    eq: function (x) {
        return function (y) {
            if (x instanceof HtmlContent && y instanceof HtmlContent) {
                return x.value0 === y.value0;
            };
            if (x instanceof VizComponent && y instanceof VizComponent) {
                return x.value0 === y.value0;
            };
            return false;
        };
    }
};
export {
    HtmlContent,
    VizComponent,
    parseContent,
    extractSegments,
    findVizTag,
    vizRegex,
    eqContentSegment,
    showContentSegment
};
//# sourceMappingURL=index.js.map
