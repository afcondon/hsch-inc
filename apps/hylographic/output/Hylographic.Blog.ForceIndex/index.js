// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Nullable from "../Data.Nullable/index.js";
import * as Data_String_CodePoints from "../Data.String.CodePoints/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Events from "../Halogen.HTML.Events/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Halogen_Subscription from "../Halogen.Subscription/index.js";
import * as Halogen_Svg_Attributes from "../Halogen.Svg.Attributes/index.js";
import * as Halogen_Svg_Attributes_Baseline from "../Halogen.Svg.Attributes.Baseline/index.js";
import * as Halogen_Svg_Attributes_Color from "../Halogen.Svg.Attributes.Color/index.js";
import * as Halogen_Svg_Attributes_TextAnchor from "../Halogen.Svg.Attributes.TextAnchor/index.js";
import * as Halogen_Svg_Attributes_Transform from "../Halogen.Svg.Attributes.Transform/index.js";
import * as Halogen_Svg_Elements from "../Halogen.Svg.Elements/index.js";
import * as Hylograph_ForceEngine_Halogen from "../Hylograph.ForceEngine.Halogen/index.js";
import * as Hylograph_ForceEngine_Setup from "../Hylograph.ForceEngine.Setup/index.js";
import * as Hylograph_Simulation from "../Hylograph.Simulation/index.js";
import * as Hylograph_Simulation_Emitter from "../Hylograph.Simulation.Emitter/index.js";
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var get = /* #__PURE__ */ Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM);
var when = /* #__PURE__ */ Control_Applicative.when(Halogen_Query_HalogenM.applicativeHalogenM);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var $$void = /* #__PURE__ */ Data_Functor["void"](Halogen_Query_HalogenM.functorHalogenM);
var mapFlipped = /* #__PURE__ */ Data_Functor.mapFlipped(Halogen_Subscription.functorEmitter);
var pure = /* #__PURE__ */ Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM);
var mod = /* #__PURE__ */ Data_EuclideanRing.mod(Data_EuclideanRing.euclideanRingInt);
var div = /* #__PURE__ */ Data_EuclideanRing.div(Data_EuclideanRing.euclideanRingInt);
var NavigateTo = /* #__PURE__ */ (function () {
    function NavigateTo(value0) {
        this.value0 = value0;
    };
    NavigateTo.create = function (value0) {
        return new NavigateTo(value0);
    };
    return NavigateTo;
})();
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var SimEvent = /* #__PURE__ */ (function () {
    function SimEvent(value0) {
        this.value0 = value0;
    };
    SimEvent.create = function (value0) {
        return new SimEvent(value0);
    };
    return SimEvent;
})();
var ClickNode = /* #__PURE__ */ (function () {
    function ClickNode(value0) {
        this.value0 = value0;
    };
    ClickNode.create = function (value0) {
        return new ClickNode(value0);
    };
    return ClickNode;
})();
var truncateTitle = function (title) {
    var $29 = Data_String_CodePoints.length(title) > 12;
    if ($29) {
        return Data_String_CodePoints.take(10)(title) + "...";
    };
    return title;
};
var renderNode = function (node) {
    return Halogen_Svg_Elements.g([ Halogen_Svg_Attributes.transform([ new Halogen_Svg_Attributes_Transform.Translate(node.x, node.y) ]), Halogen_Svg_Attributes.classes([ "force-index__node" ]), Halogen_HTML_Events.onClick(function (v) {
        return new ClickNode(node.slug);
    }) ])([ Halogen_Svg_Elements.circle([ Halogen_Svg_Attributes.cx(0.0), Halogen_Svg_Attributes.cy(0.0), Halogen_Svg_Attributes.r(30.0), Halogen_Svg_Attributes.fill(new Halogen_Svg_Attributes_Color.Named("#0066cc")), Halogen_Svg_Attributes.fillOpacity(0.8), Halogen_Svg_Attributes.classes([ "force-index__circle" ]) ]), Halogen_Svg_Elements.text([ Halogen_Svg_Attributes.textAnchor(Halogen_Svg_Attributes_TextAnchor.AnchorMiddle.value), Halogen_Svg_Attributes.dominantBaseline(Halogen_Svg_Attributes_Baseline.BaselineMiddle.value), Halogen_Svg_Attributes.fill(new Halogen_Svg_Attributes_Color.Named("white")), Halogen_Svg_Attributes.classes([ "force-index__label" ]) ])([ Halogen_HTML_Core.text(truncateTitle(node.title)) ]) ]);
};
var renderSVG = function (state) {
    return Halogen_Svg_Elements.svg([ Halogen_Svg_Attributes.viewBox(0.0)(0.0)(state.dimensions.width)(state.dimensions.height), Halogen_Svg_Attributes.width(600.0), Halogen_Svg_Attributes.height(400.0), Halogen_Svg_Attributes.classes([ "force-index__svg" ]) ])(map(renderNode)(state.nodes));
};
var render = function (state) {
    return Halogen_HTML_Elements.div([ Halogen_HTML_Properties.classes([ "force-index" ]) ])([ Halogen_HTML_Elements.h2_([ Halogen_HTML_Core.text("Articles") ]), renderSVG(state) ]);
};
var handleAction = function (dictMonadAff) {
    var liftEffect = Effect_Class.liftEffect(Halogen_Query_HalogenM.monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function (v) {
        if (v instanceof Initialize) {
            return bind(get)(function (state) {
                return when(Data_Array.length(state.nodes) > 0)((function () {
                    var simSetup = Hylograph_ForceEngine_Setup.setup("articles")([ Hylograph_ForceEngine_Setup.withStrength(Hylograph_ForceEngine_Setup["static"](-100.0))(Hylograph_ForceEngine_Setup.manyBody("charge")), Hylograph_ForceEngine_Setup.withY(Hylograph_ForceEngine_Setup["static"](200.0))(Hylograph_ForceEngine_Setup.withX(Hylograph_ForceEngine_Setup["static"](300.0))(Hylograph_ForceEngine_Setup.center("center"))), Hylograph_ForceEngine_Setup.withRadius(Hylograph_ForceEngine_Setup["static"](35.0))(Hylograph_ForceEngine_Setup.collide("collide")) ]);
                    return bind(liftEffect(Hylograph_Simulation.runSimulation({
                        engine: Hylograph_Simulation.D3.value,
                        setup: simSetup,
                        nodes: state.nodes,
                        links: [  ],
                        container: ".force-index__svg",
                        alphaMin: 1.0e-3
                    })))(function (v1) {
                        return discard(modify_(function (v2) {
                            var $32 = {};
                            for (var $33 in v2) {
                                if ({}.hasOwnProperty.call(v2, $33)) {
                                    $32[$33] = v2[$33];
                                };
                            };
                            $32.simHandle = new Data_Maybe.Just(v1.handle);
                            return $32;
                        }))(function () {
                            return bind(liftEffect(Hylograph_ForceEngine_Halogen.toHalogenEmitter(v1.events)))(function (halogenEmitter) {
                                return $$void(Halogen_Query_HalogenM.subscribe(mapFlipped(halogenEmitter)(SimEvent.create)));
                            });
                        });
                    });
                })());
            });
        };
        if (v instanceof SimEvent) {
            if (v.value0 instanceof Hylograph_Simulation_Emitter.Tick) {
                return bind(get)(function (state) {
                    if (state.simHandle instanceof Data_Maybe.Nothing) {
                        return pure(Data_Unit.unit);
                    };
                    if (state.simHandle instanceof Data_Maybe.Just) {
                        return bind(liftEffect(state.simHandle.value0.getNodes))(function (updatedNodes) {
                            return modify_(function (v1) {
                                var $39 = {};
                                for (var $40 in v1) {
                                    if ({}.hasOwnProperty.call(v1, $40)) {
                                        $39[$40] = v1[$40];
                                    };
                                };
                                $39.nodes = updatedNodes;
                                $39.alpha = v.value0.value0.alpha;
                                return $39;
                            });
                        });
                    };
                    throw new Error("Failed pattern match at Hylographic.Blog.ForceIndex (line 163, column 7 - line 168, column 62): " + [ state.simHandle.constructor.name ]);
                });
            };
            if (v.value0 instanceof Hylograph_Simulation_Emitter.Completed) {
                return pure(Data_Unit.unit);
            };
            if (v.value0 instanceof Hylograph_Simulation_Emitter.Started) {
                return pure(Data_Unit.unit);
            };
            if (v.value0 instanceof Hylograph_Simulation_Emitter.Stopped) {
                return pure(Data_Unit.unit);
            };
            throw new Error("Failed pattern match at Hylographic.Blog.ForceIndex (line 160, column 21 - line 171, column 25): " + [ v.value0.constructor.name ]);
        };
        if (v instanceof ClickNode) {
            return Halogen_Query_HalogenM.raise(new NavigateTo(v.value0));
        };
        throw new Error("Failed pattern match at Hylographic.Blog.ForceIndex (line 132, column 16 - line 174, column 30): " + [ v.constructor.name ]);
    };
};
var articlesToNodes = /* #__PURE__ */ Data_Array.mapWithIndex(function (i) {
    return function (meta) {
        return {
            id: i,
            x: 300.0 + Data_Int.toNumber(mod(i)(3)) * 100.0,
            y: 200.0 + Data_Int.toNumber(div(i)(3)) * 100.0,
            vx: 0.0,
            vy: 0.0,
            fx: Data_Nullable["null"],
            fy: Data_Nullable["null"],
            title: meta.title,
            slug: meta.slug,
            tags: meta.tags
        };
    };
});
var initialState = function (articles) {
    return {
        nodes: articlesToNodes(articles),
        alpha: 1.0,
        dimensions: {
            width: 600.0,
            height: 400.0
        },
        simHandle: Data_Maybe.Nothing.value
    };
};
var component = function (dictMonadAff) {
    return Halogen_Component.mkComponent({
        initialState: initialState,
        render: render,
        "eval": Halogen_Component.mkEval({
            handleQuery: Halogen_Component.defaultEval.handleQuery,
            receive: Halogen_Component.defaultEval.receive,
            finalize: Halogen_Component.defaultEval.finalize,
            handleAction: handleAction(dictMonadAff),
            initialize: new Data_Maybe.Just(Initialize.value)
        })
    });
};
export {
    Initialize,
    SimEvent,
    ClickNode,
    NavigateTo,
    component,
    initialState,
    articlesToNodes,
    render,
    renderSVG,
    renderNode,
    truncateTitle,
    handleAction
};
//# sourceMappingURL=index.js.map
