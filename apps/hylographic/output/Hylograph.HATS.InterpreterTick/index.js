// Generated by purs version 0.15.15
import * as $foreign from "./foreign.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Map_Internal from "../Data.Map.Internal/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Newtype from "../Data.Newtype/index.js";
import * as Data_Nullable from "../Data.Nullable/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Set from "../Data.Set/index.js";
import * as Data_Traversable from "../Data.Traversable/index.js";
import * as Data_TraversableWithIndex from "../Data.TraversableWithIndex/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect from "../Effect/index.js";
import * as Hylograph_HATS from "../Hylograph.HATS/index.js";
import * as Hylograph_HATS_Transitions from "../Hylograph.HATS.Transitions/index.js";
import * as Hylograph_Interaction_Coordinated from "../Hylograph.Interaction.Coordinated/index.js";
import * as Hylograph_Internal_Behavior_Types from "../Hylograph.Internal.Behavior.Types/index.js";
import * as Hylograph_Internal_Selection_Operations from "../Hylograph.Internal.Selection.Operations/index.js";
import * as Hylograph_Internal_Selection_Types from "../Hylograph.Internal.Selection.Types/index.js";
import * as Web_DOM_Element from "../Web.DOM.Element/index.js";
import * as Web_DOM_Node from "../Web.DOM.Node/index.js";
import * as Web_HTML from "../Web.HTML/index.js";
import * as Web_HTML_HTMLDocument from "../Web.HTML.HTMLDocument/index.js";
import * as Web_HTML_Window from "../Web.HTML.Window/index.js";
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var bind = /* #__PURE__ */ Control_Bind.bind(Effect.bindEffect);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect.applicativeEffect);
var traverse_ = /* #__PURE__ */ Data_Foldable.traverse_(Effect.applicativeEffect)(Data_Foldable.foldableArray);
var unwrap = /* #__PURE__ */ Data_Newtype.unwrap();
var map1 = /* #__PURE__ */ Data_Functor.map(Data_Maybe.functorMaybe);
var map2 = /* #__PURE__ */ Data_Functor.map(Effect.functorEffect);
var traverse = /* #__PURE__ */ Data_Traversable.traverse(Data_Traversable.traversableArray)(Effect.applicativeEffect);
var union = /* #__PURE__ */ Data_Map_Internal.union(Data_Ord.ordString);
var $$void = /* #__PURE__ */ Data_Functor["void"](Effect.functorEffect);
var traverseWithIndex = /* #__PURE__ */ Data_TraversableWithIndex.traverseWithIndex(Data_TraversableWithIndex.traversableWithIndexArray)(Effect.applicativeEffect);
var insert = /* #__PURE__ */ Data_Map_Internal.insert(Data_Ord.ordString);
var foldM = /* #__PURE__ */ Data_Array.foldM(Effect.monadEffect);
var fromFoldable = /* #__PURE__ */ Data_Set.fromFoldable(Data_Foldable.foldableArray)(Data_Ord.ordString);
var difference = /* #__PURE__ */ Data_Set.difference(Data_Ord.ordString);
var intersection = /* #__PURE__ */ Data_Set.intersection(Data_Ord.ordString);
var member = /* #__PURE__ */ Data_Set.member(Data_Ord.ordString);
var lookup = /* #__PURE__ */ Data_Map_Internal.lookup(Data_Ord.ordString);
var tooltipTriggerToInt = function (v) {
    if (v instanceof Hylograph_Internal_Behavior_Types.OnHover) {
        return 0;
    };
    if (v instanceof Hylograph_Internal_Behavior_Types.WhenPrimary) {
        return 1;
    };
    if (v instanceof Hylograph_Internal_Behavior_Types.WhenRelated) {
        return 2;
    };
    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 656, column 23 - line 659, column 19): " + [ v.constructor.name ]);
};
var interactionStateToInt = function (v) {
    if (v instanceof Hylograph_Interaction_Coordinated.Primary) {
        return 0;
    };
    if (v instanceof Hylograph_Interaction_Coordinated.Related) {
        return 1;
    };
    if (v instanceof Hylograph_Interaction_Coordinated.Selected) {
        return 2;
    };
    if (v instanceof Hylograph_Interaction_Coordinated.Dimmed) {
        return 3;
    };
    if (v instanceof Hylograph_Interaction_Coordinated.Neutral) {
        return 4;
    };
    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 663, column 25 - line 668, column 18): " + [ v.constructor.name ]);
};
var highlightClassToInt = function (v) {
    if (v instanceof Hylograph_Internal_Behavior_Types.Primary) {
        return 0;
    };
    if (v instanceof Hylograph_Internal_Behavior_Types.Related) {
        return 1;
    };
    if (v instanceof Hylograph_Internal_Behavior_Types.Dimmed) {
        return 2;
    };
    if (v instanceof Hylograph_Internal_Behavior_Types.Neutral) {
        return 3;
    };
    if (v instanceof Hylograph_Internal_Behavior_Types.Upstream) {
        return 4;
    };
    if (v instanceof Hylograph_Internal_Behavior_Types.Downstream) {
        return 5;
    };
    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 645, column 23 - line 651, column 21): " + [ v.constructor.name ]);
};
var enumerateDFS = function (root) {
    return function (getChildren) {
        return function (includeInternal) {
            var go = function (node) {
                var children = getChildren(node);
                var isLeaf = Data_Array["null"](children);
                var childResults = Data_Array.concatMap(go)(children);
                var $76 = isLeaf || includeInternal;
                if ($76) {
                    return append([ node ])(childResults);
                };
                return childResults;
            };
            return go(root);
        };
    };
};
var enumerateBFS = function (root) {
    return function (getChildren) {
        return function (includeInternal) {
            var go = function (queue) {
                var v = Data_Array.uncons(queue);
                if (v instanceof Data_Maybe.Nothing) {
                    return [  ];
                };
                if (v instanceof Data_Maybe.Just) {
                    var children = getChildren(v.value0.head);
                    var isLeaf = Data_Array["null"](children);
                    var include = isLeaf || includeInternal;
                    var thisNode = (function () {
                        if (include) {
                            return [ v.value0.head ];
                        };
                        return [  ];
                    })();
                    return append(thisNode)(go(append(v.value0.tail)(children)));
                };
                throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 550, column 14 - line 557, column 43): " + [ v.constructor.name ]);
            };
            return go([ root ]);
        };
    };
};
var runEnumeration = function (v) {
    if (v instanceof Hylograph_HATS.FromArray) {
        return v.value0;
    };
    if (v instanceof Hylograph_HATS.FromTree) {
        if (v.value0.order instanceof Hylograph_HATS.DepthFirst) {
            return enumerateDFS(v.value0.root)(v.value0.children)(v.value0.includeInternal);
        };
        if (v.value0.order instanceof Hylograph_HATS.BreadthFirst) {
            return enumerateBFS(v.value0.root)(v.value0.children)(v.value0.includeInternal);
        };
        throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 531, column 5 - line 533, column 80): " + [ v.value0.order.constructor.name ]);
    };
    if (v instanceof Hylograph_HATS.WithContext) {
        return map(function (v1) {
            return v1.datum;
        })(v.value0);
    };
    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 528, column 18 - line 534, column 41): " + [ v.constructor.name ]);
};
var elementTypeToTagName = function (v) {
    if (v instanceof Hylograph_Internal_Selection_Types.Circle) {
        return "circle";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Rect) {
        return "rect";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Path) {
        return "path";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Line) {
        return "line";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Polygon) {
        return "polygon";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Text) {
        return "text";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Group) {
        return "g";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.SVG) {
        return "svg";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Defs) {
        return "defs";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.LinearGradient) {
        return "linearGradient";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Stop) {
        return "stop";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.PatternFill) {
        return "pattern";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Div) {
        return "div";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Span) {
        return "span";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Table) {
        return "table";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Tr) {
        return "tr";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Td) {
        return "td";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Th) {
        return "th";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Tbody) {
        return "tbody";
    };
    if (v instanceof Hylograph_Internal_Selection_Types.Thead) {
        return "thead";
    };
    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 587, column 24 - line 607, column 19): " + [ v.constructor.name ]);
};
var clearContainer = function (selector) {
    return function __do() {
        var doc = (function __do() {
            var $228 = bind(Web_HTML.window)(Web_HTML_Window.document)();
            return Web_HTML_HTMLDocument.toDocument($228);
        })();
        var container = $foreign.selectElement(selector)(doc)();
        var children = $foreign.getChildElements(container)();
        return traverse_($foreign.removeElement)(children)();
    };
};
var clearChildren = function (el) {
    return function __do() {
        var children = $foreign.getChildElements(el)();
        return traverse_($foreign.removeElement)(children)();
    };
};
var appendTo = function (p) {
    return function (child) {
        return function __do() {
            Web_DOM_Node.appendChild(Web_DOM_Element.toNode(child))(Web_DOM_Element.toNode(p))();
            return Data_Unit.unit;
        };
    };
};
var rerenderTree = function (doc) {
    return function (parent) {
        return function (tree) {
            var mkUpdateTransition = function (el) {
                return function (duration) {
                    return function (delay) {
                        return function (easing) {
                            return function (v) {
                                if (v instanceof Hylograph_HATS.StaticAttr) {
                                    return function __do() {
                                        var fromStr = $foreign.getAttribute(el)(v.value0)();
                                        var $89 = {
                                            from: Data_Number.fromString(fromStr),
                                            to: Data_Number.fromString(v.value1)
                                        };
                                        if ($89.from instanceof Data_Maybe.Just && ($89.to instanceof Data_Maybe.Just && $89.from.value0 !== $89.to.value0)) {
                                            return new Data_Maybe.Just({
                                                attrName: v.value0,
                                                from: $89.from.value0,
                                                to: $89.to.value0,
                                                elapsed: 0.0,
                                                duration: duration,
                                                delay: delay,
                                                easing: easing
                                            });
                                        };
                                        return Data_Maybe.Nothing.value;
                                    };
                                };
                                if (v instanceof Hylograph_HATS.ThunkedAttr) {
                                    return function __do() {
                                        var fromStr = $foreign.getAttribute(el)(v.value0)();
                                        var toNum = Data_Number.fromString(v.value1(Data_Unit.unit));
                                        var $96 = {
                                            from: Data_Number.fromString(fromStr),
                                            to: toNum
                                        };
                                        if ($96.from instanceof Data_Maybe.Just && ($96.to instanceof Data_Maybe.Just && $96.from.value0 !== $96.to.value0)) {
                                            return new Data_Maybe.Just({
                                                attrName: v.value0,
                                                from: $96.from.value0,
                                                to: $96.to.value0,
                                                elapsed: 0.0,
                                                duration: duration,
                                                delay: delay,
                                                easing: easing
                                            });
                                        };
                                        return Data_Maybe.Nothing.value;
                                    };
                                };
                                throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 458, column 49 - line 471, column 26): " + [ v.constructor.name ]);
                            };
                        };
                    };
                };
            };
            var mkExitTransition = function (el) {
                return function (duration) {
                    return function (delay) {
                        return function (easing) {
                            return function (v) {
                                if (v instanceof Hylograph_HATS.StaticAttr) {
                                    return function __do() {
                                        var fromStr = $foreign.getAttribute(el)(v.value0)();
                                        var $104 = {
                                            from: Data_Number.fromString(fromStr),
                                            to: Data_Number.fromString(v.value1)
                                        };
                                        if ($104.from instanceof Data_Maybe.Just && $104.to instanceof Data_Maybe.Just) {
                                            return new Data_Maybe.Just({
                                                attrName: v.value0,
                                                from: $104.from.value0,
                                                to: $104.to.value0,
                                                elapsed: 0.0,
                                                duration: duration,
                                                delay: delay,
                                                easing: easing
                                            });
                                        };
                                        return Data_Maybe.Nothing.value;
                                    };
                                };
                                if (v instanceof Hylograph_HATS.ThunkedAttr) {
                                    return function __do() {
                                        var fromStr = $foreign.getAttribute(el)(v.value0)();
                                        var toVal = v.value1(Data_Unit.unit);
                                        var $111 = {
                                            from: Data_Number.fromString(fromStr),
                                            to: Data_Number.fromString(toVal)
                                        };
                                        if ($111.from instanceof Data_Maybe.Just && $111.to instanceof Data_Maybe.Just) {
                                            return new Data_Maybe.Just({
                                                attrName: v.value0,
                                                from: $111.from.value0,
                                                to: $111.to.value0,
                                                elapsed: 0.0,
                                                duration: duration,
                                                delay: delay,
                                                easing: easing
                                            });
                                        };
                                        return Data_Maybe.Nothing.value;
                                    };
                                };
                                throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 491, column 47 - line 504, column 26): " + [ v.constructor.name ]);
                            };
                        };
                    };
                };
            };
            var getAttrNum = function (targetName) {
                return function (v) {
                    if (v instanceof Hylograph_HATS.StaticAttr && v.value0 === targetName) {
                        return Data_Number.fromString(v.value1);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedAttr && v.value0 === targetName) {
                        return Data_Number.fromString(v.value1(Data_Unit.unit));
                    };
                    return Data_Maybe.Nothing.value;
                };
            };
            var findAttrValue = function (name) {
                return function (attrs) {
                    return Data_Array.findMap(getAttrNum(name))(attrs);
                };
            };
            var mkEnterTransition = function (duration) {
                return function (delay) {
                    return function (easing) {
                        return function (templateAttrs) {
                            return function (v) {
                                if (v instanceof Hylograph_HATS.StaticAttr) {
                                    var toVal = findAttrValue(v.value0)(templateAttrs);
                                    var $124 = {
                                        from: Data_Number.fromString(v.value1),
                                        to: toVal
                                    };
                                    if ($124.from instanceof Data_Maybe.Just && $124.to instanceof Data_Maybe.Just) {
                                        return pure(new Data_Maybe.Just({
                                            attrName: v.value0,
                                            from: $124.from.value0,
                                            to: $124.to.value0,
                                            elapsed: 0.0,
                                            duration: duration,
                                            delay: delay,
                                            easing: easing
                                        }));
                                    };
                                    return pure(Data_Maybe.Nothing.value);
                                };
                                if (v instanceof Hylograph_HATS.ThunkedAttr) {
                                    var fromNum = Data_Number.fromString(v.value1(Data_Unit.unit));
                                    var toVal = findAttrValue(v.value0)(templateAttrs);
                                    var $131 = {
                                        from: fromNum,
                                        to: toVal
                                    };
                                    if ($131.from instanceof Data_Maybe.Just && $131.to instanceof Data_Maybe.Just) {
                                        return pure(new Data_Maybe.Just({
                                            attrName: v.value0,
                                            from: $131.from.value0,
                                            to: $131.to.value0,
                                            elapsed: 0.0,
                                            duration: duration,
                                            delay: delay,
                                            easing: easing
                                        }));
                                    };
                                    return pure(Data_Maybe.Nothing.value);
                                };
                                throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 424, column 59 - line 437, column 26): " + [ v.constructor.name ]);
                            };
                        };
                    };
                };
            };
            var emptyResult = {
                selections: Data_Map_Internal.empty,
                entering: [  ],
                updating: [  ],
                exiting: [  ]
            };
            var createUpdateTransitions = function (el) {
                return function (templateAttrs) {
                    return function (phaseSpec) {
                        return function (idx) {
                            if (phaseSpec.transition instanceof Data_Maybe.Nothing) {
                                return pure([  ]);
                            };
                            if (phaseSpec.transition instanceof Data_Maybe.Just) {
                                var duration = unwrap(phaseSpec.transition.value0.duration);
                                var baseDelay = Data_Maybe.fromMaybe(0.0)(map1(unwrap)(phaseSpec.transition.value0.delay));
                                var staggerDelay = Data_Maybe.fromMaybe(0.0)(phaseSpec.transition.value0.staggerDelay);
                                var delay = baseDelay + staggerDelay * Data_Int.toNumber(idx);
                                var easing = Hylograph_HATS_Transitions.toTickEasing(phaseSpec.transition.value0.easing);
                                return map2(Data_Array.catMaybes)(traverse(mkUpdateTransition(el)(duration)(delay)(easing))(templateAttrs));
                            };
                            throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 446, column 5 - line 454, column 97): " + [ phaseSpec.transition.constructor.name ]);
                        };
                    };
                };
            };
            var createExitTransitions = function (el) {
                return function (phaseSpec) {
                    return function (idx) {
                        if (phaseSpec.transition instanceof Data_Maybe.Nothing) {
                            return pure([  ]);
                        };
                        if (phaseSpec.transition instanceof Data_Maybe.Just) {
                            var duration = unwrap(phaseSpec.transition.value0.duration);
                            var baseDelay = Data_Maybe.fromMaybe(0.0)(map1(unwrap)(phaseSpec.transition.value0.delay));
                            var staggerDelay = Data_Maybe.fromMaybe(0.0)(phaseSpec.transition.value0.staggerDelay);
                            var delay = baseDelay + staggerDelay * Data_Int.toNumber(idx);
                            var easing = Hylograph_HATS_Transitions.toTickEasing(phaseSpec.transition.value0.easing);
                            return map2(Data_Array.catMaybes)(traverse(mkExitTransition(el)(duration)(delay)(easing))(phaseSpec.attrs));
                        };
                        throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 479, column 5 - line 487, column 97): " + [ phaseSpec.transition.constructor.name ]);
                    };
                };
            };
            var createEnterTransitions = function (el) {
                return function (templateAttrs) {
                    return function (phaseSpec) {
                        return function (idx) {
                            if (phaseSpec.transition instanceof Data_Maybe.Nothing) {
                                return pure([  ]);
                            };
                            if (phaseSpec.transition instanceof Data_Maybe.Just) {
                                var duration = unwrap(phaseSpec.transition.value0.duration);
                                var baseDelay = Data_Maybe.fromMaybe(0.0)(map1(unwrap)(phaseSpec.transition.value0.delay));
                                var staggerDelay = Data_Maybe.fromMaybe(0.0)(phaseSpec.transition.value0.staggerDelay);
                                var delay = baseDelay + staggerDelay * Data_Int.toNumber(idx);
                                var easing = Hylograph_HATS_Transitions.toTickEasing(phaseSpec.transition.value0.easing);
                                return map2(Data_Array.catMaybes)(traverse(mkEnterTransition(duration)(delay)(easing)(templateAttrs))(phaseSpec.attrs));
                            };
                            throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 412, column 5 - line 420, column 109): " + [ phaseSpec.transition.constructor.name ]);
                        };
                    };
                };
            };
            var combineResults = function (a) {
                return function (b) {
                    return {
                        selections: union(a.selections)(b.selections),
                        entering: append(a.entering)(b.entering),
                        updating: append(a.updating)(b.updating),
                        exiting: append(a.exiting)(b.exiting)
                    };
                };
            };
            var applyIfNonNumeric = function (el) {
                return function (v) {
                    if (v instanceof Hylograph_HATS.StaticAttr) {
                        var v1 = Data_Number.fromString(v.value1);
                        if (v1 instanceof Data_Maybe.Just) {
                            return pure(Data_Unit.unit);
                        };
                        if (v1 instanceof Data_Maybe.Nothing) {
                            return $foreign.setAttribute(el)(v.value0)(v.value1);
                        };
                        throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 347, column 7 - line 349, column 46): " + [ v1.constructor.name ]);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedAttr) {
                        var value = v.value1(Data_Unit.unit);
                        var v1 = Data_Number.fromString(value);
                        if (v1 instanceof Data_Maybe.Just) {
                            return pure(Data_Unit.unit);
                        };
                        if (v1 instanceof Data_Maybe.Nothing) {
                            return $foreign.setAttribute(el)(v.value0)(value);
                        };
                        throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 352, column 10 - line 354, column 46): " + [ v1.constructor.name ]);
                    };
                    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 345, column 26 - line 354, column 46): " + [ v.constructor.name ]);
                };
            };
            var applyNonNumericAttrs = function (el) {
                return function (attrs) {
                    return function __do() {
                        traverse(applyIfNonNumeric(el))(attrs)();
                        return Data_Unit.unit;
                    };
                };
            };
            var applyBehavior = function (el) {
                return function (v) {
                    if (v instanceof Hylograph_HATS.ThunkedMouseEnter) {
                        return $foreign.attachMouseEnterThunked(el)(v.value0);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedMouseLeave) {
                        return $foreign.attachMouseLeaveThunked(el)(v.value0);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedClick) {
                        return $foreign.attachClickThunked(el)(v.value0);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedDrag && v.value0 instanceof Hylograph_Internal_Behavior_Types.SimpleDrag) {
                        return $foreign.attachSimpleDrag(el);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedDrag && v.value0 instanceof Hylograph_Internal_Behavior_Types.SimulationDrag) {
                        return $foreign.attachSimulationDragById(el)(v.value0.value0);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedDrag && v.value0 instanceof Hylograph_Internal_Behavior_Types.SimulationDragNested) {
                        return $foreign.attachSimulationDragNestedById(el)(v.value0.value0);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedZoom) {
                        return $foreign.attachZoom(el)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedCoordinatedHighlight) {
                        var triggerAsInt = tooltipTriggerToInt(v.value0.tooltipTrigger);
                        var classifyAsInt = function (hoveredId) {
                            return highlightClassToInt(v.value0.classify(hoveredId));
                        };
                        return $foreign.attachCoordinatedHighlightThunked(el)(v.value0.identify)(classifyAsInt)(Data_Nullable.toNullable(v.value0.group))(Data_Nullable.toNullable(v.value0.tooltipContent))(triggerAsInt);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedCoordinatedInteraction) {
                        var respondToHover = function (hoveredId) {
                            return interactionStateToInt(v.value0.respond(new Hylograph_Interaction_Coordinated.HoverTrigger(hoveredId)));
                        };
                        var respondToClear = function (v1) {
                            return interactionStateToInt(v.value0.respond(Hylograph_Interaction_Coordinated.ClearTrigger.value));
                        };
                        var respondToBrush = function (box) {
                            return interactionStateToInt(v.value0.respond(new Hylograph_Interaction_Coordinated.BrushTrigger(box)));
                        };
                        return $foreign.attachCoordinatedInteractionThunked(el)(v.value0.identify)(respondToHover)(respondToBrush)(respondToClear)(v.value0.position)(Data_Nullable.toNullable(v.value0.group));
                    };
                    if (v instanceof Hylograph_HATS.ThunkedBrush) {
                        return $$void($foreign.attachCoordinatedBrushThunked(el)(v.value0.extent)(Data_Nullable.toNullable(v.value0.group)));
                    };
                    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 366, column 22 - line 399, column 86): " + [ v.constructor.name ]);
                };
            };
            var applyBehaviors = function (el) {
                return function (behaviors) {
                    return function __do() {
                        traverse(applyBehavior(el))(behaviors)();
                        return Data_Unit.unit;
                    };
                };
            };
            var applyAttr = function (el) {
                return function (v) {
                    if (v instanceof Hylograph_HATS.StaticAttr) {
                        return $foreign.setAttribute(el)(v.value0)(v.value1);
                    };
                    if (v instanceof Hylograph_HATS.ThunkedAttr) {
                        return $foreign.setAttribute(el)(v.value0)(v.value1(Data_Unit.unit));
                    };
                    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 335, column 18 - line 337, column 64): " + [ v.constructor.name ]);
                };
            };
            var applyAttrs = function (el) {
                return function (attrs) {
                    return function __do() {
                        traverse(applyAttr(el))(attrs)();
                        return Data_Unit.unit;
                    };
                };
            };
            var renderEnteringItem = function (p) {
                return function (foldName) {
                    return function (keyFn) {
                        return function (template) {
                            return function (gupSpec) {
                                return function (idx) {
                                    return function (datum) {
                                        var itemTree = template(datum);
                                        var key = keyFn(datum);
                                        if (itemTree instanceof Hylograph_HATS.Elem) {
                                            return function __do() {
                                                var el = Hylograph_Internal_Selection_Operations.createElementWithNS(itemTree.value0.elemType)(doc)();
                                                appendTo(p)(el)();
                                                $foreign.setKey(el)(key)();
                                                $foreign.setFoldName(el)(foldName)();
                                                $foreign.bindDatum(el)(datum)();
                                                applyAttrs(el)(itemTree.value0.attrs)();
                                                var transitions = (function () {
                                                    if (gupSpec instanceof Data_Maybe.Just) {
                                                        if (gupSpec.value0.enter instanceof Data_Maybe.Just) {
                                                            var ts = createEnterTransitions(el)(itemTree.value0.attrs)(gupSpec.value0.enter.value0)(idx)();
                                                            applyAttrs(el)(gupSpec.value0.enter.value0.attrs)();
                                                            return new Data_Maybe.Just({
                                                                element: el,
                                                                attrs: ts
                                                            });
                                                        };
                                                        if (gupSpec.value0.enter instanceof Data_Maybe.Nothing) {
                                                            return Data_Maybe.Nothing.value;
                                                        };
                                                        throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 282, column 22 - line 287, column 36): " + [ gupSpec.value0.enter.constructor.name ]);
                                                    };
                                                    if (gupSpec instanceof Data_Maybe.Nothing) {
                                                        return Data_Maybe.Nothing.value;
                                                    };
                                                    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 281, column 24 - line 288, column 34): " + [ gupSpec.constructor.name ]);
                                                })();
                                                applyBehaviors(el)(itemTree.value0.behaviors)();
                                                var childMaps = traverse(goWithDatum(el))(itemTree.value0.children)();
                                                return {
                                                    element: el,
                                                    childSelections: Data_Array.foldl(union)(Data_Map_Internal.empty)(map(function (v) {
                                                        return v.selections;
                                                    })(childMaps)),
                                                    transitions: transitions
                                                };
                                            };
                                        };
                                        return function __do() {
                                            var el = Hylograph_Internal_Selection_Operations.createElementWithNS(Hylograph_Internal_Selection_Types.Group.value)(doc)();
                                            return {
                                                element: el,
                                                childSelections: Data_Map_Internal.empty,
                                                transitions: Data_Maybe.Nothing.value
                                            };
                                        };
                                    };
                                };
                            };
                        };
                    };
                };
            };
            var goWithDatum = function (p) {
                return function (v) {
                    if (v instanceof Hylograph_HATS.Empty) {
                        return pure(emptyResult);
                    };
                    if (v instanceof Hylograph_HATS.Elem) {
                        return function __do() {
                            var el = Hylograph_Internal_Selection_Operations.createElementWithNS(v.value0.elemType)(doc)();
                            appendTo(p)(el)();
                            applyAttrs(el)(v.value0.attrs)();
                            applyBehaviors(el)(v.value0.behaviors)();
                            var childResults = traverse(goWithDatum(el))(v.value0.children)();
                            return Data_Array.foldl(combineResults)(emptyResult)(childResults);
                        };
                    };
                    if (v instanceof Hylograph_HATS.MkFold) {
                        return Hylograph_HATS.runSomeFold(v.value0)(function (foldSpec) {
                            var items = runEnumeration(foldSpec.enumerate);
                            return function __do() {
                                var results = traverseWithIndex(renderEnteringItem(p)(foldSpec.name)(foldSpec.keyFn)(foldSpec.template)(foldSpec.gup))(items)();
                                var elements = map(function (v1) {
                                    return v1.element;
                                })(results);
                                var childMaps = Data_Array.foldl(union)(Data_Map_Internal.empty)(map(function (v1) {
                                    return v1.childSelections;
                                })(results));
                                return {
                                    selections: insert(foldSpec.name)(elements)(childMaps),
                                    entering: [ Data_Array.catMaybes(map(function (v1) {
                                        return v1.transitions;
                                    })(results)) ],
                                    updating: [  ],
                                    exiting: [  ]
                                };
                            };
                        });
                    };
                    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 304, column 19 - line 323, column 10): " + [ v.constructor.name ]);
                };
            };
            var processChildren = function (p) {
                return function (children) {
                    var processChild = function (v) {
                        return function (child) {
                            return function __do() {
                                var v1 = goWithDomIdx(p)(v.domIdx)(child)();
                                return {
                                    result: combineResults(v.result)(v1.result),
                                    domIdx: v.domIdx + v1.elementsCreated | 0
                                };
                            };
                        };
                    };
                    return function __do() {
                        var v = foldM(processChild)({
                            result: emptyResult,
                            domIdx: 0
                        })(children)();
                        return v.result;
                    };
                };
            };
            var goWithDomIdx = function (p) {
                return function (domIdx) {
                    return function (v) {
                        if (v instanceof Hylograph_HATS.Empty) {
                            return pure({
                                result: emptyResult,
                                elementsCreated: 0
                            });
                        };
                        if (v instanceof Hylograph_HATS.Elem) {
                            return function __do() {
                                var existingChildren = $foreign.getChildElements(p)();
                                var el = (function () {
                                    var v1 = Data_Array.index(existingChildren)(domIdx);
                                    if (v1 instanceof Data_Maybe.Just) {
                                        applyAttrs(v1.value0)(v.value0.attrs)();
                                        applyBehaviors(v1.value0)(v.value0.behaviors)();
                                        return v1.value0;
                                    };
                                    if (v1 instanceof Data_Maybe.Nothing) {
                                        var el = Hylograph_Internal_Selection_Operations.createElementWithNS(v.value0.elemType)(doc)();
                                        appendTo(p)(el)();
                                        applyAttrs(el)(v.value0.attrs)();
                                        applyBehaviors(el)(v.value0.behaviors)();
                                        return el;
                                    };
                                    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 137, column 13 - line 147, column 18): " + [ v1.constructor.name ]);
                                })();
                                var childResult = processChildren(el)(v.value0.children)();
                                return {
                                    result: childResult,
                                    elementsCreated: 1
                                };
                            };
                        };
                        if (v instanceof Hylograph_HATS.MkFold) {
                            return Hylograph_HATS.runSomeFold(v.value0)(function (spec) {
                                var items = runEnumeration(spec.enumerate);
                                var newKeys = fromFoldable(map(spec.keyFn)(items));
                                var tagName = elementTypeToTagName(spec.elementType);
                                return function __do() {
                                    var existingEls = $foreign.getChildElementsForFold(p)(tagName)(spec.name)();
                                    var existingKeysAndEls = traverse(function (el) {
                                        return function __do() {
                                            var k = $foreign.getKey(el)();
                                            return {
                                                key: k,
                                                element: el
                                            };
                                        };
                                    })(existingEls)();
                                    var existingKeys = fromFoldable(map(function (v1) {
                                        return v1.key;
                                    })(existingKeysAndEls));
                                    var enterKeys = difference(newKeys)(existingKeys);
                                    var updateKeys = intersection(newKeys)(existingKeys);
                                    var exitKeys = difference(existingKeys)(newKeys);
                                    var exitTransitions = traverseWithIndex(function (exitIdx) {
                                        return function (v1) {
                                            var $197 = member(v1.key)(exitKeys);
                                            if ($197) {
                                                if (spec.gup instanceof Data_Maybe.Just) {
                                                    if (spec.gup.value0.exit instanceof Data_Maybe.Just) {
                                                        return function __do() {
                                                            var transitions = createExitTransitions(v1.element)(spec.gup.value0.exit.value0)(exitIdx)();
                                                            applyNonNumericAttrs(v1.element)(spec.gup.value0.exit.value0.attrs)();
                                                            return new Data_Maybe.Just({
                                                                element: v1.element,
                                                                attrs: transitions
                                                            });
                                                        };
                                                    };
                                                    if (spec.gup.value0.exit instanceof Data_Maybe.Nothing) {
                                                        return function __do() {
                                                            $foreign.removeElement(v1.element)();
                                                            return Data_Maybe.Nothing.value;
                                                        };
                                                    };
                                                    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 172, column 29 - line 181, column 29): " + [ spec.gup.value0.exit.constructor.name ]);
                                                };
                                                if (spec.gup instanceof Data_Maybe.Nothing) {
                                                    return function __do() {
                                                        $foreign.removeElement(v1.element)();
                                                        return Data_Maybe.Nothing.value;
                                                    };
                                                };
                                                throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 171, column 16 - line 184, column 27): " + [ spec.gup.constructor.name ]);
                                            };
                                            return pure(Data_Maybe.Nothing.value);
                                        };
                                    })(existingKeysAndEls)();
                                    var updateTransitions = traverseWithIndex(function (updateIdx) {
                                        return function (v1) {
                                            var $205 = member(v1.key)(updateKeys);
                                            if ($205) {
                                                var v2 = Data_Array.find(function (d) {
                                                    return spec.keyFn(d) === v1.key;
                                                })(items);
                                                if (v2 instanceof Data_Maybe.Just) {
                                                    return function __do() {
                                                        $foreign.bindDatum(v1.element)(v2.value0)();
                                                        var templateTree = spec.template(v2.value0);
                                                        var templateAttrs = (function () {
                                                            if (templateTree instanceof Hylograph_HATS.Elem) {
                                                                return templateTree.value0.attrs;
                                                            };
                                                            return [  ];
                                                        })();
                                                        var templateChildren = (function () {
                                                            if (templateTree instanceof Hylograph_HATS.Elem) {
                                                                return templateTree.value0.children;
                                                            };
                                                            return [  ];
                                                        })();
                                                        if (spec.gup instanceof Data_Maybe.Just) {
                                                            if (spec.gup.value0.update instanceof Data_Maybe.Just) {
                                                                applyNonNumericAttrs(v1.element)(templateAttrs)();
                                                                var transitions = createUpdateTransitions(v1.element)(templateAttrs)(spec.gup.value0.update.value0)(updateIdx)();
                                                                clearChildren(v1.element)();
                                                                traverse(goWithDatum(v1.element))(templateChildren)();
                                                                return new Data_Maybe.Just({
                                                                    element: v1.element,
                                                                    attrs: transitions
                                                                });
                                                            };
                                                            if (spec.gup.value0.update instanceof Data_Maybe.Nothing) {
                                                                applyAttrs(v1.element)(templateAttrs)();
                                                                clearChildren(v1.element)();
                                                                traverse(goWithDatum(v1.element))(templateChildren)();
                                                                return Data_Maybe.Nothing.value;
                                                            };
                                                            throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 204, column 33 - line 217, column 33): " + [ spec.gup.value0.update.constructor.name ]);
                                                        };
                                                        if (spec.gup instanceof Data_Maybe.Nothing) {
                                                            applyAttrs(v1.element)(templateAttrs)();
                                                            clearChildren(v1.element)();
                                                            traverse(goWithDatum(v1.element))(templateChildren)();
                                                            return Data_Maybe.Nothing.value;
                                                        };
                                                        throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 203, column 15 - line 223, column 31): " + [ spec.gup.constructor.name ]);
                                                    };
                                                };
                                                if (v2 instanceof Data_Maybe.Nothing) {
                                                    return pure(Data_Maybe.Nothing.value);
                                                };
                                                throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 191, column 16 - line 224, column 36): " + [ v2.constructor.name ]);
                                            };
                                            return pure(Data_Maybe.Nothing.value);
                                        };
                                    })(existingKeysAndEls)();
                                    var enterItems = Data_Array.filter(function (d) {
                                        return member(spec.keyFn(d))(enterKeys);
                                    })(items);
                                    var enterResults = traverseWithIndex(renderEnteringItem(p)(spec.name)(spec.keyFn)(spec.template)(spec.gup))(enterItems)();
                                    var updateElements = map(function (v1) {
                                        return v1.element;
                                    })(Data_Array.filter(function (v1) {
                                        return member(v1.key)(updateKeys);
                                    })(existingKeysAndEls));
                                    var enterElements = map(function (v1) {
                                        return v1.element;
                                    })(enterResults);
                                    var childMaps = Data_Array.foldl(union)(Data_Map_Internal.empty)(map(function (v1) {
                                        return v1.childSelections;
                                    })(enterResults));
                                    var selections = insert(spec.name)(append(updateElements)(enterElements))(childMaps);
                                    var totalElements = Data_Array.length(updateElements) + Data_Array.length(enterElements) | 0;
                                    return {
                                        result: {
                                            selections: selections,
                                            entering: [ Data_Array.catMaybes(map(function (v1) {
                                                return v1.transitions;
                                            })(enterResults)) ],
                                            updating: [ Data_Array.catMaybes(updateTransitions) ],
                                            exiting: [ Data_Array.catMaybes(exitTransitions) ]
                                        },
                                        elementsCreated: totalElements
                                    };
                                };
                            });
                        };
                        throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 132, column 27 - line 248, column 10): " + [ v.constructor.name ]);
                    };
                };
            };
            return function __do() {
                var v = goWithDomIdx(parent)(0)(tree)();
                var allEntering = Data_Array.concat(v.result.entering);
                var allUpdating = Data_Array.concat(v.result.updating);
                var allExiting = Data_Array.concat(v.result.exiting);
                var hasTransitions = !(Data_Array["null"](allEntering) && (Data_Array["null"](allUpdating) && Data_Array["null"](allExiting)));
                return {
                    selections: v.result.selections,
                    transitions: (function () {
                        if (hasTransitions) {
                            return new Data_Maybe.Just({
                                entering: allEntering,
                                updating: allUpdating,
                                exiting: allExiting
                            });
                        };
                        return Data_Maybe.Nothing.value;
                    })()
                };
            };
        };
    };
};
var rerender = function (selector) {
    return function (tree) {
        return function __do() {
            var doc = (function __do() {
                var $229 = bind(Web_HTML.window)(Web_HTML_Window.document)();
                return Web_HTML_HTMLDocument.toDocument($229);
            })();
            var container = $foreign.selectElement(selector)(doc)();
            return rerenderTree(doc)(container)(tree)();
        };
    };
};
var rerenderInto = function (selections) {
    return function (name) {
        return function (tree) {
            return function __do() {
                var doc = (function __do() {
                    var $230 = bind(Web_HTML.window)(Web_HTML_Window.document)();
                    return Web_HTML_HTMLDocument.toDocument($230);
                })();
                var v = lookup(name)(selections);
                if (v instanceof Data_Maybe.Nothing) {
                    return {
                        selections: Data_Map_Internal.empty,
                        transitions: Data_Maybe.Nothing.value
                    };
                };
                if (v instanceof Data_Maybe.Just) {
                    var v1 = Data_Array.head(v.value0);
                    if (v1 instanceof Data_Maybe.Nothing) {
                        return {
                            selections: Data_Map_Internal.empty,
                            transitions: Data_Maybe.Nothing.value
                        };
                    };
                    if (v1 instanceof Data_Maybe.Just) {
                        return rerenderTree(doc)(v1.value0)(tree)();
                    };
                    throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 92, column 22 - line 94, column 56): " + [ v1.constructor.name ]);
                };
                throw new Error("Failed pattern match at Hylograph.HATS.InterpreterTick (line 90, column 3 - line 94, column 56): " + [ v.constructor.name ]);
            };
        };
    };
};
export {
    rerender,
    rerenderInto,
    clearContainer
};
//# sourceMappingURL=index.js.map
