// Generated by purs version 0.15.15
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect_Aff_Class from "../Effect.Aff.Class/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Effect_Random from "../Effect.Random/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Halogen_Svg_Attributes from "../Halogen.Svg.Attributes/index.js";
import * as Halogen_Svg_Attributes_Color from "../Halogen.Svg.Attributes.Color/index.js";
import * as Halogen_Svg_Elements from "../Halogen.Svg.Elements/index.js";
import * as Zoo_LSystem_Grammar from "../Zoo.LSystem.Grammar/index.js";
import * as Zoo_LSystem_Render from "../Zoo.LSystem.Render/index.js";
import * as Zoo_LSystem_Schemes from "../Zoo.LSystem.Schemes/index.js";
import * as Zoo_LSystem_Types from "../Zoo.LSystem.Types/index.js";
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordInt);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var widthForDepth = function (d) {
    var pow = function (base) {
        return function (exp) {
            var $25 = exp <= 0.0;
            if ($25) {
                return 1.0;
            };
            return base * pow(base)(exp - 1.0);
        };
    };
    return 2.0 * pow(0.75)(Data_Int.toNumber(d));
};
var plantSystems = [ Zoo_LSystem_Grammar.fractalPlant, Zoo_LSystem_Grammar.simplePlant, Zoo_LSystem_Grammar.binaryTree ];
var depthColors = [ "#2d5a27", "#3d7a37", "#4d9a47", "#5dba57", "#6dda67", "#7dfa77", "#8dff87", "#9dff97" ];
var colorForDepth = function (d) {
    var idx = min(d)(Data_Array.length(depthColors) - 1 | 0);
    return Data_Maybe.fromMaybe("#2d5a27")(Data_Array.index(depthColors)(idx));
};
var renderSegment = function (depth) {
    return function (seg) {
        return Halogen_Svg_Elements.line([ Halogen_Svg_Attributes.x1(seg.x1), Halogen_Svg_Attributes.y1(seg.y1), Halogen_Svg_Attributes.x2(seg.x2), Halogen_Svg_Attributes.y2(seg.y2), Halogen_Svg_Attributes.stroke(new Halogen_Svg_Attributes_Color.Named(colorForDepth(depth))), Halogen_Svg_Attributes.strokeWidth(widthForDepth(depth)) ]);
    };
};
var renderDepthGroup = function (depth) {
    return function (segments) {
        return Halogen_Svg_Elements.g([ Halogen_Svg_Attributes.classes([ "depth-" + show(depth) ]) ])(map(renderSegment(depth))(segments));
    };
};
var renderSegments = function (segments) {
    var maxDepth = foldl(function (m) {
        return function (s) {
            return max(m)(s.depth);
        };
    })(0)(segments);
    var depthGroups = map(function (d) {
        return Data_Array.filter(function (s) {
            return s.depth === d;
        })(segments);
    })(Data_Array.range(0)(maxDepth));
    return Data_Array.mapWithIndex(renderDepthGroup)(depthGroups);
};
var renderSVG = function (state) {
    if (Data_Array["null"](state.segments)) {
        return Halogen_Svg_Elements.svg([ Halogen_Svg_Attributes.classes([ "lsystem-svg" ]) ])([  ]);
    };
    if (Data_Boolean.otherwise) {
        var bounds = Zoo_LSystem_Render.calculateBounds(state.segments);
        var h = (bounds.maxY - bounds.minY) + 50.0 + 10.0;
        var minX = bounds.minX - 10.0;
        var minY = bounds.minY - 50.0;
        var w = (bounds.maxX - bounds.minX) + 10.0 + 50.0;
        return Halogen_Svg_Elements.svg([ Halogen_Svg_Attributes.viewBox(minX)(minY)(w)(h), Halogen_Svg_Attributes.classes([ "lsystem-svg" ]) ])(renderSegments(state.segments));
    };
    throw new Error("Failed pattern match at Hylographic.Viz.LSystemPlant (line 62, column 1 - line 62, column 60): " + [ state.constructor.name ]);
};
var render = function (state) {
    return Halogen_HTML_Elements.div([ Halogen_HTML_Properties.classes([ "lsystem-background" ]) ])([ renderSVG(state) ]);
};
var backgroundRenderConfig = function (scale) {
    return {
        widthScale: Zoo_LSystem_Types.defaultRenderConfig.widthScale,
        colorByDepth: Zoo_LSystem_Types.defaultRenderConfig.colorByDepth,
        stepLength: 12.0 * scale,
        lengthScale: 0.5,
        strokeWidth: 2.5
    };
};
var handleAction = function (dictMonadAff) {
    var liftEffect = Effect_Class.liftEffect(Halogen_Query_HalogenM.monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function (v) {
        return bind(liftEffect(Effect_Random.randomInt(0)(Data_Array.length(plantSystems) - 1 | 0)))(function (idx) {
            var system = Data_Maybe.fromMaybe(Zoo_LSystem_Grammar.fractalPlant)(Data_Array.index(plantSystems)(idx));
            return bind(liftEffect(Effect_Random.randomInt(4)(6)))(function (iterations) {
                return bind(liftEffect(Effect_Random.randomInt(80)(150)))(function (scaleInt) {
                    var scale = Data_Int.toNumber(scaleInt) / 100.0;
                    var segments = Zoo_LSystem_Schemes.render(iterations)(system)(backgroundRenderConfig(scale));
                    return modify_(function (v1) {
                        var $28 = {};
                        for (var $29 in v1) {
                            if ({}.hasOwnProperty.call(v1, $29)) {
                                $28[$29] = v1[$29];
                            };
                        };
                        $28.system = new Data_Maybe.Just(system);
                        $28.segments = segments;
                        $28.iterations = iterations;
                        $28.scale = scale;
                        return $28;
                    });
                });
            });
        });
    };
};
var component = /* #__PURE__ */ (function () {
    return Halogen_Component.mkComponent({
        initialState: function (v) {
            return {
                system: Data_Maybe.Nothing.value,
                segments: [  ],
                iterations: 5,
                scale: 1.0
            };
        },
        render: render,
        "eval": Halogen_Component.mkEval({
            handleQuery: Halogen_Component.defaultEval.handleQuery,
            receive: Halogen_Component.defaultEval.receive,
            finalize: Halogen_Component.defaultEval.finalize,
            handleAction: handleAction(Effect_Aff_Class.monadAffAff),
            initialize: new Data_Maybe.Just(Initialize.value)
        })
    });
})();
export {
    plantSystems,
    Initialize,
    component,
    render,
    renderSVG,
    renderSegments,
    renderDepthGroup,
    renderSegment,
    depthColors,
    colorForDepth,
    widthForDepth,
    backgroundRenderConfig,
    handleAction
};
//# sourceMappingURL=index.js.map
