# Worklog: 2026-01-12

## Session Focus
Meta-session to improve Claude Code collaboration practices: establishing session logging, knowledge base structure, and engineering discipline guardrails.

## Accomplished
- Created `docs/worklog/` structure for session logging
- Added session logging practices to CLAUDE.md
- Established template for daily worklog entries
- Deep analysis of all spago.yaml files across showcases/, site/, visualisation libraries/
- Cross-referenced Makefile bundle targets with spago.yaml configs and index.html imports
- Documented build conventions for all 6 backends in CLAUDE.md
- Established "Rule Zero": ALL builds through Makefile only
- Added `make verify-bundles` target to check co-location rule
- Enforced strict bundle naming: `bundle.js` only (no exceptions)
- Standardized 4 non-conforming projects (psd3-tidal, demo-website, react-proof, showcase-shell-demo)
- Fixed showcase-shell-demo spago.yaml extraPackages paths
- Deleted stale bundle files (app.js, index.js, output/bundle.js)
- Created knowledge base structure (`docs/kb/`) with 6 categories
- Classified 38 markdown reports across the ecosystem
- Created INDEX.md with full report catalog and metadata
- Copied key docs to kb/ (kernel-separation, polyglot-ffi, hackage-analysis, claude-context)
- Added KB conventions to CLAUDE.md

## Key Findings from Build Analysis

**Discrepancies identified:**
- `wasm-force-demo`: spago.yaml has no bundle config; Makefile bundles to `dist/bundle.js` but index.html uses WASM directly (special case)
- `psd3-arid-keystone`: spago.yaml has no bundle config; Makefile is sole source of truth for `demo/bundle.js`
- Two bundle naming conventions: `bundle.js` (standard) vs `index.js` (psd3-tidal, site/website)

**What works well:**
- Co-location rule holds: all index.html files reference bundles in same directory
- Makefile correctly handles all the complexity
- When both spago.yaml and Makefile specify paths, they agree

**Root cause of past issues:**
- Running `spago bundle` directly without Makefile leads to wrong outputs
- Projects without spago.yaml bundle config REQUIRE the Makefile flags

**Verification results (`make verify-bundles`):**
- 10/10 browser targets now pass verification
- Standardized all to `bundle.js` (no exceptions)

## Explored But Not Pursued
- Automatic spago.yaml generation from Makefile (too complex, Makefile is already source of truth)
- Unified registry version across all projects (different projects have different requirements: 57.1.0, 67.0.1, 70.0.0)

## Parking Lot
- Integrating KB with existing Antora docs infrastructure
- Adding frontmatter to all 38 indexed reports (currently only key docs have it)
- Periodic KB maintenance: re-classify stale reports, update index

## Decisions Made
- Worklog lives in `docs/worklog/` with dated files (YYYY-MM-DD.md)
- Template provides consistent structure without being burdensome
- "Explored But Not Pursued" section specifically captures abandoned paths
- **Makefile is the canonical source of truth** for build commands
- **Co-location rule** is the key invariant for browser targets
- Build conventions documented per-backend in CLAUDE.md

## Reports Generated
- Build conventions added to CLAUDE.md (not a separate report)

## Next Session Setup
- Knowledge base structure still to be designed (converting reports â†’ searchable KB)
- Run `make verify-bundles` after builds to catch issues early
- All browser targets now standardized on `bundle.js` in same directory as `index.html`
